<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Web OS avec Google</title>
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <style>
    body {
      margin: 0;
      font-family: sans-serif;
      background-color: #111;
      color: white;
      height: 100vh;
      display: flex;
      flex-direction: column;
    }
    header {
      background-color: #222;
      padding: 10px;
      position: fixed;
      width: 100%;
      top: 0;
      left: 0;
      display: flex;
      align-items: center;
      justify-content: space-between;
      z-index: 1000;
    }
    #clock {
      font-size: 18px;
    }
    #profile {
      display: none;
    }
    #logout-btn {
      padding: 6px 12px;
      background: crimson;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      color: white;
    }
    main {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }
    #dock {
      position: fixed;
      bottom: 10px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(255, 255, 255, 0.1);
      padding: 10px;
      border-radius: 20px;
      display: flex;
      gap: 10px;
      backdrop-filter: blur(10px);
      z-index: 1000;
    }
    .dock-icon {
      width: 40px;
      height: 40px;
      cursor: pointer;
    }
    #file-manager {
      background: #333;
      padding: 20px;
      border-radius: 10px;
      margin-top: 20px;
      display: none;
    }
    #file-manager ul {
      list-style: none;
      padding: 0;
    }
    #file-manager li {
      margin: 5px 0;
    }
    .window {
      position: absolute;
      background: #222;
      border: 1px solid #444;
      border-radius: 6px;
      width: 600px;
      height: 400px;
      top: 100px;
      left: 100px;
      z-index: 999;
      display: flex;
      flex-direction: column;
    }
    .window-header {
      background: #333;
      padding: 5px 10px;
      cursor: move;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .window iframe {
      flex: 1;
      border: none;
      width: 100%;
    }
    .close-btn {
      background: crimson;
      border: none;
      color: white;
      cursor: pointer;
      border-radius: 4px;
      padding: 0 8px;
    }
  </style>
</head>
<body>
  <header>
    <div id="clock"></div>
    <div id="profile">
      Connecté : <span id="user-name"></span>
      (<span id="user-email"></span>)
      <button id="logout-btn" onclick="logout()">Déconnexion</button>
    </div>
  </header>

  <main>
    <h1>Web OS – Connexion avec Google</h1>

    <div id="g_id_onload"
         data-client_id="908397631579-20c8p66k2ag6rkqhkc8u5r4nqaihndou.apps.googleusercontent.com"
         data-callback="handleCredentialResponse"
         data-auto_prompt="false">
    </div>

    <div class="g_id_signin"
         data-type="standard"
         data-size="large"
         data-theme="outline"
         data-text="signin_with"
         data-shape="rectangular"
         data-logo_alignment="left">
    </div>

    <div id="file-manager">
      <h2>Gestionnaire de fichiers</h2>
      <input type="text" id="new-filename" placeholder="Nom du fichier">
      <button onclick="createFile()">Créer</button>
      <ul id="file-list"></ul>
    </div>
  </main>

  <div id="dock">
    <img src="https://cdn-icons-png.flaticon.com/512/716/716784.png" class="dock-icon" title="Fichiers" onclick="toggleFileManager()">
    <img src="https://cdn-icons-png.flaticon.com/512/300/300221.png" class="dock-icon" title="Gmail" onclick="openApp('https://mail.google.com')">
    <img src="https://cdn-icons-png.flaticon.com/512/1384/1384060.png" class="dock-icon" title="YouTube" onclick="openApp('https://youtube.com')">
    <img src="https://cdn-icons-png.flaticon.com/512/2702/2702602.png" class="dock-icon" title="Google Drive" onclick="openApp('https://drive.google.com')">
    <img src="https://cdn-icons-png.flaticon.com/512/5968/5968517.png" class="dock-icon" title="Google Docs" onclick="openApp('https://docs.google.com')">
    <img src="https://cdn-icons-png.flaticon.com/512/3314/3314265.png" class="dock-icon" title="Google Sheets" onclick="openApp('https://sheets.google.com')">
    <img src="https://cdn-icons-png.flaticon.com/512/2702/2702603.png" class="dock-icon" title="Google Agenda" onclick="openApp('https://calendar.google.com')">
    <img src="https://cdn-icons-png.flaticon.com/512/2811/2811806.png" class="dock-icon" title="Recherche" onclick="openGoogleSearch()">
  </div>

  <script>
    function handleCredentialResponse(response) {
      const data = parseJwt(response.credential);
      document.getElementById('user-name').textContent = data.name;
      document.getElementById('user-email').textContent = data.email;
      document.getElementById('profile').style.display = 'block';
      document.querySelector('.g_id_signin').style.display = 'none';
    }

    function logout() {
      google.accounts.id.disableAutoSelect();
      document.getElementById('profile').style.display = 'none';
      document.querySelector('.g_id_signin').style.display = 'block';
    }

    function parseJwt(token) {
      const base64Url = token.split('.')[1];
      const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
      const jsonPayload = decodeURIComponent(atob(base64).split('').map(c =>
        '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2)
      ).join(''));
      return JSON.parse(jsonPayload);
    }

    function updateClock() {
      const now = new Date();
      document.getElementById('clock').textContent = now.toLocaleTimeString();
    }
    setInterval(updateClock, 1000);
    updateClock();

    function toggleFileManager() {
      const fm = document.getElementById('file-manager');
      fm.style.display = fm.style.display === 'none' ? 'block' : 'none';
      loadFiles();
    }

    function createFile() {
      const name = document.getElementById('new-filename').value;
      if (!name) return;
      localStorage.setItem(name, '');
      loadFiles();
    }

    function loadFiles() {
      const list = document.getElementById('file-list');
      list.innerHTML = '';
      for (let i = 0; i < localStorage.length; i++) {
        const key = localStorage.key(i);
        const li = document.createElement('li');
        li.textContent = key;
        list.appendChild(li);
      }
    }

    function openGoogleSearch() {
      const query = prompt("Que voulez-vous rechercher sur Google ?");
      if (query) {
        window.open(`https://www.google.com/search?q=${encodeURIComponent(query)}`, '_blank');
      }
    }

    function openApp(url) {
      const win = document.createElement('div');
      win.className = 'window';
      win.innerHTML = `
        <div class="window-header">
          <span>${url}</span>
          <button class="close-btn" onclick="this.parentElement.parentElement.remove()">X</button>
        </div>
        <iframe src="${url}"></iframe>
      `;
      document.body.appendChild(win);
      dragElement(win);
    }

    function dragElement(elmnt) {
      const header = elmnt.querySelector(".window-header");
      let pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;
      header.onmousedown = dragMouseDown;
      function dragMouseDown(e) {
        e = e || window.event;
        e.preventDefault();
        pos3 = e.clientX;
        pos4 = e.clientY;
        document.onmouseup = closeDragElement;
        document.onmousemove = elementDrag;
      }
      function elementDrag(e) {
        e = e || window.event;
        e.preventDefault();
        pos1 = pos3 - e.clientX;
        pos2 = pos4 - e.clientY;
        pos3 = e.clientX;
        pos4 = e.clientY;
        elmnt.style.top = (elmnt.offsetTop - pos2) + "px";
        elmnt.style.left = (elmnt.offsetLeft - pos1) + "px";
      }
      function closeDragElement() {
        document.onmouseup = null;
        document.onmousemove = null;
      }
    }
  </script>
</body>
</html>

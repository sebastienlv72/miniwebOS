<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>WebOS PWA</title>

<!-- Manifest PWA -->
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#111111">

<!-- Google Sign-In -->
<script src="https://accounts.google.com/gsi/client" async defer></script>

<!-- Google Fonts & Material Icons -->
<link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

<style>
  html, body {
    margin:0; padding:0;
    height:100%; width:100%;
    font-family: 'Roboto', sans-serif;
    background: url('https://source.unsplash.com/1920x1080/?city,landscape') no-repeat center center fixed;
    background-size: cover;
    display: flex; flex-direction: column;
    overflow: hidden;
  }

  #top-bar {
    display:flex;
    justify-content: flex-end;
    padding:10px;
    background: rgba(0,0,0,0.5);
    color:white;
  }

  #logout-btn {
    background: crimson;
    border:none; border-radius:6px;
    padding:6px 12px;
    cursor:pointer;
    color:white;
    display:none;
  }

  #profile { display:none; color:white; margin-right:20px; }

  #dock {
    display:flex; justify-content:center;
    position:fixed; bottom:0; left:0; right:0;
    background: rgba(0,0,0,0.6);
    padding:10px;
    gap:20px;
    display:none;
  }

  .dock-btn {
    display:flex; flex-direction:column; align-items:center;
    cursor:pointer;
    color:white;
    font-size:12px;
    text-decoration:none;
  }

  .dock-btn img {
    width:40px; height:40px; margin-bottom:5px;
  }

  #search-bar {
    position:fixed; bottom:70px; left:50%; transform:translateX(-50%);
    width:90%; max-width:500px;
    display:none;
  }

  #search-bar input {
    width:100%; padding:10px; border-radius:20px;
    border:none; outline:none;
    font-size:16px;
  }

  #file-explorer {
    position:absolute; top:60px; left:20px;
    width:300px; max-height:60%;
    background: rgba(255,255,255,0.95);
    color:black;
    border-radius:10px;
    overflow:auto;
    padding:10px;
    display:none;
  }

  #file-explorer h3 { margin-top:0; }

  @media (max-width:768px) {
    #file-explorer { width:80%; max-height:40%; }
    .dock-btn img { width:30px; height:30px; }
  }
</style>
</head>
<body>

<div id="top-bar">
  <div id="profile"></div>
  <button id="logout-btn" onclick="logout()">Déconnexion</button>
</div>

<!-- Google Sign-In -->
<div id="g_id_onload"
     data-client_id="908397631579-20c8p66k2ag6rkqhkc8u5r4nqaihndou.apps.googleusercontent.com"
     data-callback="handleCredentialResponse"
     data-auto_prompt="false">
</div>
<div class="g_id_signin"
     data-type="standard"
     data-size="large"
     data-theme="outline"
     data-text="signin_with"
     data-shape="rectangular"
     data-logo_alignment="left">
</div>

<!-- Search Bar -->
<div id="search-bar">
  <input type="text" placeholder="Rechercher sur Google..." onkeydown="if(event.key==='Enter'){ window.open('https://www.google.com/search?q='+this.value,'_blank'); }">
</div>

<!-- Dock -->
<div id="dock">
  <a href="https://mail.google.com/" target="_blank" class="dock-btn">
    <img src="https://www.gstatic.com/images/branding/product/1x/gmail_48dp.png">
    Gmail
  </a>
  <a href="https://www.youtube.com/" target="_blank" class="dock-btn">
    <img src="https://www.gstatic.com/youtube/img/branding/yt_icon_rgb_48.png">
    YouTube
  </a>
  <a href="https://drive.google.com/" target="_blank" class="dock-btn">
    <img src="https://www.gstatic.com/images/branding/product/1x/drive_48dp.png">
    Drive
  </a>
  <a href="https://docs.google.com/" target="_blank" class="dock-btn">
    <img src="https://www.gstatic.com/images/branding/product/1x/docs_48dp.png">
    Docs
  </a>
  <a href="https://sheets.google.com/" target="_blank" class="dock-btn">
    <img src="https://www.gstatic.com/images/branding/product/1x/sheets_48dp.png">
    Sheets
  </a>
  <a href="https://calendar.google.com/" target="_blank" class="dock-btn">
    <img src="https://www.gstatic.com/images/branding/product/1x/calendar_48dp.png">
    Agenda
  </a>
</div>

<!-- File Explorer -->
<div id="file-explorer">
  <h3>Explorateur de fichiers</h3>
  <ul id="file-list"></ul>
</div>

<script>
  function handleCredentialResponse(response) {
    const data = parseJwt(response.credential);
    document.getElementById('profile').textContent = data.name;
    document.getElementById('profile').style.display = 'block';
    document.getElementById('logout-btn').style.display = 'inline-block';
    document.querySelector('.g_id_signin').style.display = 'none';
    document.getElementById('dock').style.display = 'flex';
    document.getElementById('search-bar').style.display = 'block';
    document.getElementById('file-explorer').style.display = 'block';
  }

  function logout() {
    google.accounts.id.disableAutoSelect();
    document.getElementById('profile').style.display = 'none';
    document.getElementById('logout-btn').style.display = 'none';
    document.querySelector('.g_id_signin').style.display = 'block';
    document.getElementById('dock').style.display = 'none';
    document.getElementById('search-bar').style.display = 'none';
    document.getElementById('file-explorer').style.display = 'none';
  }

  function parseJwt(token) {
    const base64Url = token.split('.')[1];
    const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
    const jsonPayload = decodeURIComponent(atob(base64).split('').map(c =>
      '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2)
    ).join(''));
    return JSON.parse(jsonPayload);
  }

  // Exemple de fichiers pour explorateur
  const files = ['Documents', 'Images', 'Videos', 'Musique'];
  const fileList = document.getElementById('file-list');
  files.forEach(f => {
    const li = document.createElement('li');
    li.textContent = f;
    fileList.appendChild(li);
  });

  // PWA Service Worker
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
      navigator.serviceWorker.register('/service-worker.js')
        .then(() => console.log('Service Worker enregistré'))
        .catch(err => console.error('Service Worker erreur', err));
    });
  }
</script>

</body>
</html>
